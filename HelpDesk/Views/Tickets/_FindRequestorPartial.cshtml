<style>
.dialog input-with-button {
    position:relative;
}
.dialog input-with-button input {
    padding-right: 40px;
}
.dialog .input-with-button button {
    position: absolute;
    right: 0;
    top: 25px;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}
</style>

<div id="FindRequestorDialog" class="dialog">
    <h4>Find requestor to ticket <i id="FindRequestorTitle"></i></h4>

    <div class="form-group input-with-button">
        <label>Find user by name of email</label>
        <input value="" id="FindRequestorInput" class="form-control" />
        <button id="find" class="btn btn-warning">
            <span class="glyphicon glyphicon-search"></span>
        </button>
    </div>

    <div class="form-group" style="overflow: auto">
        <label>Choose user</label>
        <select class="form-control" id="requestorsList"></select>
        <img id="progress-image" src="http://i.stack.imgur.com/r6tWv.gif" class="pull-left" style="display: none" />
    </div>

    <input id="FindRequestorBtnOk" type="button" class="btn btn-warning" value="Ok" />
    <input id="FindRequestorBtnCancel" type="button" class="btn btn-warning" value="Cancel" />

</div>
<script>
    $(document).ready(function()
    {
        $("#FindRequestorDialog").dialog(
        {
            autoOpen: false,
            modal: true,
            resizable: false
        });        

        $("#find-requestor-btn").click(function(e)
        {
            e.preventDefault();
            $('#FindRequestorDialog').dialog('open');
        });

        $("#find").click(function(e)
        {
            $('#FindRequestorDialog').dialog('open');
            $("#progress-image").show();
            $.post("/Tickets/FindUsers", { search: $("#FindRequestorInput").val() }, function(data)
            {
                if (data.length == 0)
                {
                    $("#requestorsList").html("<option></option>");
                }
                else
                {
                    $("#requestorsList").html("");
                    for (var i = 0; i < data.length; i++)
                    {
                        $("#requestorsList").append("<option value=" + data[i].UserID + ">" + data[i].FirstName + " " + data[i].LastName + " (" + data[i].Email + ")</option>");
                    }
                }
                $("#progress-image").hide();
            }, "json");

        });

        $("#FindRequestorBtnOk").click(function()
        {
            if ($("#requestorsList").val() && $("#requestorsList").val() != "")
            {
                $("#RequestedByID").val($("#requestorsList").val());
                $("#requestorInp").val($("#requestorsList > option[value=" + $("#requestorsList").val() + "]").html());
                $("#FindRequestorInput").val("");
                $("#requestorsList").val("");
            }
            $('#FindRequestorDialog').dialog('close');
        });

        $("#FindRequestorBtnCancel").click(function()
        {
            $('#FindRequestorDialog').dialog('close');
        });
    });
</script>
