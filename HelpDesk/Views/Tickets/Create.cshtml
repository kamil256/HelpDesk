@model HelpDesk.Models.TicketsCreateViewModel
@using HelpDesk.Entities

@{
    ViewBag.Title = "New ticket";
}

<h2>Add new request</h2>

<hr />

@using (Html.BeginForm(@*"Create", "Tickets", FormMethod.Get*@)) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.RequestorID)
        <div class="form-group">
            <label class = "control-label col-md-2">Requestor</label>
            <div class="col-md-10">
                <input value="@Model.Requestor.FirstName @Model.Requestor.LastName (@Model.Requestor.Email)" id="requestorInp" class="form-control pull-left" disabled="disabled" />
                <span class="pull-left">&nbsp;</span>
                <button id="findRequestorBtn" class="btn btn-warning pull-left" onclick="event.preventDefault(); $('#findRequestorDialog').dialog('open');">Change</button>
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Category, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("Category", Model.Categories, new { @class = "form-control", id = "arequestorsList" })
                @Html.ValidationMessageFor(model => model.Category, "", new { @class = "text-danger" })
            </div>
        </div>
        
        <div class="form-group">
            @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Content, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextAreaFor(model => model.Content, 10, 10, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Content, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-warning" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@Html.Partial("_FindRequestorPartial")

<script>
    //$("#findRequestor").click(function(e)
    //{
        
    //        e.preventDefault();
    //        $.post("/Tickets/FindUsers", { search: $("#searchedUser").val() }, function(data)
    //        {
    //            if (data.length == 0)
    //            {
    //                $("#requestorsList").html("<option value=''></option>");
    //            }
    //            else
    //            {
    //                $("#requestorsList").html("");
    //                for (var i = 0; i < data.length; i++)
    //                {
    //                    $("#requestorsList").append("<option value=" + data[i].Email + ">" + data[i].FirstName + " " + data[i].LastName + " (" + data[i].Email + ")</option>");
    //                }
    //            }
    //        }, "json");
                
    //    });
</script>
